{% extends "base.html" %}

{% block title %}জুনিয়র উস্তাদ ব্যবস্থাপনা (Simple) - মাদ্রাসা উম্মুল কুরা{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <h1 class="text-3xl font-bold text-gray-900 mb-6">
        <i class="fas fa-user-plus text-green-600 mr-2"></i>
        জুনিয়র উস্তাদ ব্যবস্থাপনা (Simple Version)
    </h1>

    <!-- Create Form -->
    <div class="card max-w-2xl mb-6">
        <h2 class="text-xl font-bold mb-4">নতুন জুনিয়র উস্তাদ যোগ করুন</h2>
        <form id="createForm" class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-2">প্রথম নাম *</label>
                    <input type="text" name="first_name" required class="form-input w-full border rounded px-3 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">শেষ নাম *</label>
                    <input type="text" name="last_name" required class="form-input w-full border rounded px-3 py-2">
                </div>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-2">ফোন নম্বর *</label>
                    <input type="tel" name="phone" required class="form-input w-full border rounded px-3 py-2" placeholder="01XXXXXXXXX">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">ইমেইল</label>
                    <input type="email" name="email" class="form-input w-full border rounded px-3 py-2">
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">পাসওয়ার্ড *</label>
                <input type="password" name="password" required class="form-input w-full border rounded px-3 py-2">
            </div>
            <button type="submit" class="btn-primary">
                <i class="fas fa-save mr-2"></i>
                সংরক্ষণ করুন
            </button>
        </form>
        <div id="result" class="mt-4"></div>
    </div>

    <!-- List -->
    <div class="card">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">জুনিয়র উস্তাদের তালিকা</h2>
            <button onclick="loadList()" class="btn-secondary">
                <i class="fas fa-sync mr-2"></i>
                রিফ্রেশ
            </button>
        </div>
        <div id="listContainer">
            <p class="text-gray-500">লোড হচ্ছে...</p>
        </div>
    </div>
</div>

<script>
// Load list on page load
window.addEventListener('DOMContentLoaded', function() {
    loadList();
});

// Handle form submission
document.getElementById('createForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = {
        first_name: e.target.first_name.value,
        last_name: e.target.last_name.value,
        phone: e.target.phone.value,
        email: e.target.email.value,
        password: e.target.password.value
    };
    
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = '<p class="text-blue-600">সংরক্ষণ হচ্ছে...</p>';
    
    try {
        const response = await fetch('/api/junior-ustad/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (data.success) {
            resultDiv.innerHTML = '<div class="p-4 bg-green-100 text-green-800 rounded">' +
                '<i class="fas fa-check-circle mr-2"></i>' + data.message + 
                '<br><strong>' + data.data.name + '</strong> (' + data.data.phone + ')' +
                '</div>';
            
            // Clear form
            e.target.reset();
            
            // Reload list
            setTimeout(loadList, 500);
        } else {
            resultDiv.innerHTML = '<div class="p-4 bg-red-100 text-red-800 rounded">' +
                '<i class="fas fa-times-circle mr-2"></i>' + data.error +
                '</div>';
        }
    } catch (error) {
        resultDiv.innerHTML = '<div class="p-4 bg-red-100 text-red-800 rounded">' +
            '<i class="fas fa-exclamation-triangle mr-2"></i>Error: ' + error.message +
            '</div>';
    }
});

async function loadList() {
    const container = document.getElementById('listContainer');
    container.innerHTML = '<p class="text-gray-500">লোড হচ্ছে...</p>';
    
    try {
        const response = await fetch('/api/junior-ustad/');
        const data = await response.json();
        
        if (data.success && data.data.junior_ustads.length > 0) {
            const html = '<table class="min-w-full divide-y divide-gray-200">' +
                '<thead class="bg-gray-50">' +
                '<tr>' +
                '<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">নাম</th>' +
                '<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ফোন</th>' +
                '<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ইমেইল</th>' +
                '<th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">স্ট্যাটাস</th>' +
                '</tr>' +
                '</thead>' +
                '<tbody class="bg-white divide-y divide-gray-200">' +
                data.data.junior_ustads.map(ju => 
                    '<tr>' +
                    '<td class="px-6 py-4 whitespace-nowrap">' + ju.name + '</td>' +
                    '<td class="px-6 py-4 whitespace-nowrap">' + ju.phone + '</td>' +
                    '<td class="px-6 py-4 whitespace-nowrap">' + (ju.email || '-') + '</td>' +
                    '<td class="px-6 py-4 text-center">' +
                    '<span class="px-2 py-1 text-xs rounded-full ' + 
                    (ju.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800') + '">' +
                    (ju.is_active ? 'সক্রিয়' : 'নিষ্ক্রিয়') +
                    '</span>' +
                    '</td>' +
                    '</tr>'
                ).join('') +
                '</tbody>' +
                '</table>';
            
            container.innerHTML = html;
        } else {
            container.innerHTML = '<p class="text-gray-500 text-center py-8">কোনো জুনিয়র উস্তাদ পাওয়া যায়নি</p>';
        }
    } catch (error) {
        container.innerHTML = '<p class="text-red-500">Error: ' + error.message + '</p>';
    }
}
</script>
{% endblock %}
